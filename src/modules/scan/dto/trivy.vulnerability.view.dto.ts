import { ApiPropertyOptional, ApiProperty } from '@nestjs/swagger';
import type { TrivyCvssScore } from '../types/trivy';
import { TrivySeverityType } from '../types/trivy';

export class TrivyVulnerability {
  @ApiProperty({ description: 'Vulnerability ID' })
  VulnerabilityID: string;

  @ApiPropertyOptional({ description: 'Package ID' })
  PkgID?: string;

  @ApiPropertyOptional({ description: 'Package name' })
  PkgName?: string;

  @ApiPropertyOptional({ description: 'Package identifier' })
  PkgIdentifier?: {
    PURL?: string;
    UID?: string;
  };

  @ApiPropertyOptional({ description: 'Installed version' })
  InstalledVersion?: string;

  @ApiPropertyOptional({ description: 'Fixed version' })
  FixedVersion?: string;

  @ApiPropertyOptional({
    description: 'Status: fixed, affected, unknown, will_not_fix, etc.',
  })
  Status?: string;

  @ApiPropertyOptional({ description: 'Layer information' })
  Layer?: {
    DiffID?: string;
  };

  @ApiPropertyOptional({ description: 'Primary URL' })
  PrimaryURL?: string;

  @ApiPropertyOptional({ description: 'Data source' })
  DataSource?: {
    ID?: string;
    Name?: string;
    URL?: string;
  };

  @ApiPropertyOptional({ description: 'Vulnerability title' })
  Title?: string;

  @ApiPropertyOptional({ description: 'Vulnerability description' })
  Description?: string;

  @ApiPropertyOptional({
    enum: Object.values(TrivySeverityType),
    description: 'Severity level',
  })
  Severity?: TrivySeverityType;

  @ApiPropertyOptional({ type: [String], description: 'CWE IDs' })
  CweIDs?: string[];

  @ApiPropertyOptional({ description: 'Vendor severity' })
  VendorSeverity?: Record<string, number>;

  @ApiPropertyOptional({ description: 'CVSS scores' })
  CVSS?: Record<string, TrivyCvssScore>;

  @ApiPropertyOptional({ type: [String], description: 'References' })
  References?: string[];

  @ApiPropertyOptional({ description: 'Published date' })
  PublishedDate?: string;

  @ApiPropertyOptional({ description: 'Last modified date' })
  LastModifiedDate?: string;
}
