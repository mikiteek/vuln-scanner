import { ApiPropertyOptional, ApiProperty } from '@nestjs/swagger';
import { Expose } from 'class-transformer';
import type { TrivyCvssScore } from '../types/trivy';
import { TrivySeverityType } from '../types/trivy';

export class TrivyVulnerability {
  @ApiProperty({ description: 'Vulnerability ID' })
  @Expose()
  VulnerabilityID: string;

  @ApiPropertyOptional({ description: 'Package ID' })
  @Expose()
  PkgID?: string;

  @ApiPropertyOptional({ description: 'Package name' })
  @Expose()
  PkgName?: string;

  @ApiPropertyOptional({ description: 'Package identifier' })
  @Expose()
  PkgIdentifier?: {
    PURL?: string;
    UID?: string;
  };

  @ApiPropertyOptional({ description: 'Installed version' })
  @Expose()
  InstalledVersion?: string;

  @ApiPropertyOptional({ description: 'Fixed version' })
  @Expose()
  FixedVersion?: string;

  @ApiPropertyOptional({
    description: 'Status: fixed, affected, unknown, will_not_fix, etc.',
  })
  @Expose()
  Status?: string;

  @ApiPropertyOptional({ description: 'Layer information' })
  @Expose()
  Layer?: {
    DiffID?: string;
  };

  @ApiPropertyOptional({ description: 'Primary URL' })
  @Expose()
  PrimaryURL?: string;

  @ApiPropertyOptional({ description: 'Data source' })
  @Expose()
  DataSource?: {
    ID?: string;
    Name?: string;
    URL?: string;
  };

  @ApiPropertyOptional({ description: 'Vulnerability title' })
  @Expose()
  Title?: string;

  @ApiPropertyOptional({ description: 'Vulnerability description' })
  @Expose()
  Description?: string;

  @ApiPropertyOptional({
    enum: Object.values(TrivySeverityType),
    description: 'Severity level',
  })
  @Expose()
  Severity?: TrivySeverityType;

  @ApiPropertyOptional({ type: [String], description: 'CWE IDs' })
  @Expose()
  CweIDs?: string[];

  @ApiPropertyOptional({ description: 'Vendor severity' })
  @Expose()
  VendorSeverity?: Record<string, number>;

  @ApiPropertyOptional({ description: 'CVSS scores' })
  @Expose()
  CVSS?: Record<string, TrivyCvssScore>;

  @ApiPropertyOptional({ type: [String], description: 'References' })
  @Expose()
  References?: string[];

  @ApiPropertyOptional({ description: 'Published date' })
  @Expose()
  PublishedDate?: string;

  @ApiPropertyOptional({ description: 'Last modified date' })
  @Expose()
  LastModifiedDate?: string;
}
